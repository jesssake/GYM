<div class="login-page-container">
    <div class="login-box">

        <h1 class="title">Crear una cuenta</h1>

        <h2 class="subtitle-registro">Registrarse con el correo electrónico</h2>

        <div *ngIf="errorMessage" class="alert-error validation-message">
            {{ errorMessage }}
        </div>

        <div class="back-to-login">
            ¿Ya tienes una cuenta?
            <a [routerLink]="['/login']" class="link-login">Iniciar sesión</a>
        </div>

        <form #f="ngForm" (ngSubmit)="onSubmit(f)" class="login-form" novalidate>

            <div class="form-group">
                <label for="nombres">Nombre(s)</label>

                <input
                    type="text"
                    id="nombres"
                    name="nombres"
                    required
                    ngModel
                    #nombresInput="ngModel"
                    placeholder="Tu nombre(s)"
                    class="form-input-text"
                >

                <div *ngIf="nombresInput.invalid && (nombresInput.dirty || nombresInput.touched || f.submitted)"
                     class="validation-message">
                    <span *ngIf="nombresInput.errors?.['required']">
                        El nombre(s) es obligatorio.
                    </span>
                </div>
            </div>

            <div class="form-group">
                <label for="apellidos">Apellido(s)</label>

                <input
                    type="text"
                    id="apellidos"
                    name="apellidos"
                    required
                    ngModel
                    #apellidosInput="ngModel"
                    placeholder="Tu apellido(s)"
                    class="form-input-text"
                >

                <div *ngIf="apellidosInput.invalid && (apellidosInput.dirty || apellidosInput.touched || f.submitted)"
                     class="validation-message">
                    <span *ngIf="apellidosInput.errors?.['required']">
                        El apellido(s) es obligatorio.
                    </span>
                </div>
            </div>

            <div class="form-group">
                <label for="email">Dirección de correo electrónico</label>

                <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    email
                    ngModel
                    #emailInput="ngModel"
                    placeholder="tu.correo@ejemplo.com"
                    (input)="onEmailChange(emailInput.value)"
                    class="form-input-text"
                >

                <div *ngIf="emailInput.invalid && (emailInput.dirty || emailInput.touched || f.submitted)"
                     class="validation-message">

                    <span *ngIf="emailInput.errors?.['required']">
                        Por favor, ingresa tu correo electrónico.
                    </span>

                    <span *ngIf="emailInput.errors?.['email']">
                        El formato del correo electrónico es incorrecto.
                    </span>

                </div>
            </div>

            <div class="form-group">

                <label for="password">Contraseña</label>

                <div class="password-input-group">
                    <input
                        [type]="passwordVisible ? 'text' : 'password'"
                        id="password"
                        name="password"
                        required
                        minlength="8"
                        ngModel
                        #passwordInput="ngModel"
                        (input)="onPasswordChange(passwordInput.value)"
                    >

                    <button
                        type="button"
                        class="toggle-password"
                        (click)="togglePasswordVisibility()"
                        aria-label="Mostrar/Ocultar contraseña"
                    >
                        <i
                            class="fa-solid"
                            [ngClass]="passwordVisible ? 'fa-eye' : 'fa-eye-slash'"
                        ></i>
                    </button>
                </div>

                <div *ngIf="passwordInput.invalid && (passwordInput.dirty || passwordInput.touched || f.submitted)"
                     class="validation-message">

                    <span *ngIf="passwordInput.errors?.['required']">
                        La contraseña es obligatoria.
                    </span>

                    <span *ngIf="passwordInput.errors?.['minlength']">
                        La contraseña debe tener al menos 8 caracteres.
                    </span>

                </div>

                <div class="password-rules-container" *ngIf="passwordInput.value?.length > 0">
                    <h3>Crea una contraseña que:</h3>

                    <ul>
                        <li
                            [class.valid]="passwordRules.minLength"
                            [class.invalid]="!passwordRules.minLength"
                        >
                            <i
                                class="fa-solid"
                                [ngClass]="passwordRules.minLength ? 'fa-check-circle' : 'fa-times-circle'"
                            ></i>
                            Contenga al menos 8 caracteres
                        </li>

                        <li
                            [class.valid]="passwordRules.hasBothCases"
                            [class.invalid]="!passwordRules.hasBothCases"
                        >
                            <i
                                class="fa-solid"
                                [ngClass]="passwordRules.hasBothCases ? 'fa-check-circle' : 'fa-times-circle'"
                            ></i>
                            Contenga tanto letras minúsculas (a-z) como mayúsculas (A-Z)
                        </li>

                        <li
                            [class.valid]="passwordRules.hasNumberOrSymbol"
                            [class.invalid]="!passwordRules.hasNumberOrSymbol"
                        >
                            <i
                                class="fa-solid"
                                [ngClass]="passwordRules.hasNumberOrSymbol ? 'fa-check-circle' : 'fa-times-circle'"
                            ></i>
                            Contenga al menos un número (0-9) o un símbolo
                        </li>

                        <li
                            [class.valid]="passwordRules.notContainsEmail"
                            [class.invalid]="!passwordRules.notContainsEmail"
                        >
                            <i
                                class="fa-solid"
                                [ngClass]="passwordRules.notContainsEmail ? 'fa-check-circle' : 'fa-times-circle'"
                            ></i>
                            No contenga tu dirección de correo electrónico
                        </li>
                    </ul>
                </div>

            </div>

            <button
                type="submit"
                class="btn-primary"
                [disabled]="!f.valid || !allRulesMet || isLoading"
            >
                {{ isLoading ? 'Registrando...' : 'Crear Cuenta' }}
            </button>

        </form>
    </div>
</div>
