<!-- gesti√≥n-contacto.component.html -->
<div class="gestion-contacto-container">
  <h2>Gesti√≥n de Informaci√≥n de Contacto</h2>
  
  <form (ngSubmit)="guardarCambios()" class="contacto-form">
    
    <!-- Direcci√≥n F√≠sica con Google Places Autocomplete -->
    <div class="form-group">
      <label for="direccionFisica">Direcci√≥n F√≠sica:</label>
      <div class="direccion-busqueda">
        <input 
          type="text" 
          id="direccionFisica" 
          [(ngModel)]="direccionBusqueda" 
          name="direccionBusqueda"
          placeholder="Escribe y selecciona una direcci√≥n..."
          class="form-control direccion-input"
          #direccionInput
        />
        <div class="botones-busqueda">
          <button type="button" (click)="usarMiUbicacion()" class="btn-mi-ubicacion" title="Usar mi ubicaci√≥n actual">
            üìç Mi Ubicaci√≥n
          </button>
          <button type="button" (click)="buscarDireccion()" class="btn-buscar">
            üîç Buscar Direcci√≥n
          </button>
        </div>
      </div>
      <small>Escribe la direcci√≥n y selecciona de la lista, o usa tu ubicaci√≥n actual</small>
    </div>

    <!-- Selector de tipo de lugar -->
    <div class="form-group" *ngIf="mostrarSelectorTipo">
      <label for="tipoLugar">Tipo de Lugar:</label>
      <select 
        id="tipoLugar" 
        [(ngModel)]="tipoLugarSeleccionado" 
        name="tipoLugar"
        class="form-control"
        (change)="actualizarUrlConTipoLugar()"
      >
        <option value="place">Lugar espec√≠fico</option>
        <option value="view">Vista de mapa</option>
        <option value="streetview">Street View</option>
      </select>
      <small>Elige c√≥mo quieres mostrar la ubicaci√≥n en el mapa</small>
    </div>

    <!-- Opciones del mapa -->
    <div class="opciones-mapa" *ngIf="mostrarMapa">
      <h4>Opciones del Mapa:</h4>
      <div class="opciones-grid">
        <div class="opcion">
          <label>
            <input 
              type="checkbox" 
              [(ngModel)]="mostrarControles" 
              name="mostrarControles"
              (change)="actualizarOpcionesMapa()"
            />
            Mostrar controles de navegaci√≥n
          </label>
        </div>
        <div class="opcion">
          <label>
            <input 
              type="checkbox" 
              [(ngModel)]="mostrarEtiquetas" 
              name="mostrarEtiquetas"
              (change)="actualizarOpcionesMapa()"
            />
            Mostrar etiquetas de lugares
          </label>
        </div>
        <div class="opcion">
          <label>
            <input 
              type="checkbox" 
              [(ngModel)]="modoSatelite" 
              name="modoSatelite"
              (change)="actualizarOpcionesMapa()"
            />
            Vista sat√©lite
          </label>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="telefono">N√∫mero Telef√≥nico:</label>
      <input 
        type="tel" 
        id="telefono" 
        [(ngModel)]="contactoInfo.telefono" 
        name="telefono"
        placeholder="+525555123456"
        class="form-control"
        pattern="^\+[1-9]\d{1,14}$"
      />
      <small>Formato internacional: +525555123456</small>
    </div>

    <div class="form-group">
      <label for="correoElectronico">Correo Electr√≥nico:</label>
      <input 
        type="email" 
        id="correoElectronico" 
        [(ngModel)]="contactoInfo.correoElectronico" 
        name="correoElectronico"
        placeholder="contacto@ejemplo.com"
        class="form-control"
      />
      <small>Correo electr√≥nico de contacto principal</small>
    </div>

    <!-- Vista previa del mapa generado -->
    <div class="vista-mapa-directo" *ngIf="mostrarMapa">
      <h4>Vista Previa del Mapa:</h4>
      <div class="mapa-generado">
        <iframe 
          [src]="mapaUrl" 
          width="100%" 
          height="300" 
          style="border:0;" 
          allowfullscreen="" 
          loading="lazy" 
          referrerpolicy="no-referrer-when-downgrade"
          [title]="'Ubicaci√≥n: ' + contactoInfo.direccionFisica"
          sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"
        ></iframe>
      </div>
      <div class="url-generada">
        <p><strong>URL del Mapa Embed:</strong></p>
        <div class="url-container">
          <code class="url-codigo">{{ contactoInfo.direccionGoogleMaps | truncateUrl:70 }}</code>
          <div class="acciones-url">
            <button type="button" (click)="copiarUrl()" class="btn-copiar" title="Copiar URL">
              üìã Copiar
            </button>
            <button type="button" (click)="abrirEnNuevaPestana()" class="btn-abrir" title="Abrir en nueva pesta√±a">
              ‚Üó Abrir
            </button>
            <button type="button" (click)="generarUrlCorta()" class="btn-corto" title="Generar URL corta">
              üîó Corta
            </button>
          </div>
        </div>
        <div class="info-coordenadas" *ngIf="coordenadas">
          <p><strong>Coordenadas:</strong> {{ coordenadas.lat | number:'1.6-6' }}, {{ coordenadas.lng | number:'1.6-6' }}</p>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" (click)="probarMapa()" class="btn-probar" *ngIf="mostrarMapa">
        üîÑ Probar Mapa
      </button>
      <button type="submit" class="btn-guardar">
        üíæ Guardar Cambios
      </button>
    </div>

  </form>

  <!-- Mapa final guardado -->
  <div class="mapa-final" *ngIf="contactoInfo.direccionGoogleMaps && contactoInfo.direccionGoogleMaps !== 'https://maps.google.com/maps?q=&output=embed'">
    <div class="header-mapa-final">
      <h3>üìç Mapa de Contacto Guardado</h3>
      <div class="acciones-mapa-final">
        <button type="button" (click)="editarMapa()" class="btn-editar">
          ‚úèÔ∏è Editar
        </button>
      </div>
    </div>
    <div class="mapa-frame-final">
      <iframe 
        [src]="mapaUrl" 
        width="100%" 
        height="400" 
        style="border:0;" 
        allowfullscreen="" 
        loading="lazy" 
        referrerpolicy="no-referrer-when-downgrade"
        [title]="'Ubicaci√≥n guardada: ' + contactoInfo.direccionFisica"
        sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"
      ></iframe>
    </div>
    <div class="info-mapa-final">
      <p><strong>Direcci√≥n:</strong> {{ contactoInfo.direccionFisica }}</p>
      <p><strong>Tel√©fono:</strong> {{ contactoInfo.telefono }}</p>
      <p><strong>Email:</strong> {{ contactoInfo.correoElectronico }}</p>
      <p><strong>URL del mapa:</strong> 
        <a [href]="contactoInfo.direccionGoogleMaps" target="_blank" rel="noopener noreferrer" class="link-mapa">
          {{ contactoInfo.direccionGoogleMaps | truncateUrl:50 }}
        </a>
      </p>
    </div>
  </div>
</div>