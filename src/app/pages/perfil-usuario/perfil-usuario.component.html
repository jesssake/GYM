<div class="profile-container">
    <div class="profile-card">

        <h1>Mi Perfil de Usuario</h1>

        <!-- SECCIÓN DE FOTO -->
        <div class="photo-section">
            <img
                *ngIf="fotoPerfil; else sinFotoTemplate"
                [src]="fotoPerfil"
                class="profile-image"
                alt="Foto de perfil del usuario"
            />

            <ng-template #sinFotoTemplate>
                <div class="default-profile-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
            </ng-template>

            <button
                class="photo-upload-label"
                (click)="abrirCropper()"
                aria-label="Cambiar foto de perfil"
            >
                <i class="fas fa-camera"></i> Cambiar Foto
            </button>
        </div>

        <h2 class="section-heading">Información de Cuenta</h2>

        <!-- FORMULARIO DE DATOS -->
        <form #perfilForm="ngForm">
            <div class="form-grid">

                <div class="form-field">
                    <label for="nombre">Nombre:</label>
                    <input
                        type="text"
                        id="nombre"
                        name="nombre"
                        [(ngModel)]="usuario.nombre"
                        required
                    />
                </div>

                <div class="form-field">
                    <label for="email">Email:</label>
                    <input
                        type="email"
                        id="email"
                        [value]="usuario.email"
                        disabled
                    />
                </div>

                <div class="form-field">
                    <label for="fechaNacimiento">Fecha de Nacimiento:</label>
                    <input
                        type="date"
                        id="fechaNacimiento"
                        name="fechaNacimiento"
                        [(ngModel)]="usuario.fechaNacimiento"
                    />
                </div>

                <div class="form-field">
                    <label for="rol">Rol:</label>
                    <input
                        type="text"
                        id="rol"
                        [value]="usuario.rol"
                        disabled
                    />
                </div>
            </div>

            <h2 class="section-heading">Datos Biométricos y Metas</h2>

            <div class="form-grid">

                <div class="form-field">
                    <label for="peso">Peso (kg):</label>
                    <input
                        type="number"
                        id="peso"
                        name="peso"
                        [(ngModel)]="usuario.peso"
                        step="0.1"
                        min="10"
                    />
                </div>

                <div class="form-field">
                    <label for="altura">Altura (cm):</label>
                    <input
                        type="number"
                        id="altura"
                        name="altura"
                        [(ngModel)]="usuario.altura"
                        min="50"
                    />
                </div>

                <div class="form-field" style="grid-column: 1 / -1;">
                    <label for="meta">Meta Principal:</label>
                    <select
                        id="meta"
                        name="meta"
                        [(ngModel)]="usuario.meta"
                    >
                        <option value="Ganar músculo">Ganar músculo</option>
                        <option value="Bajar de peso">Bajar de peso</option>
                        <option value="Mantenerse en forma">Mantenerse en forma</option>
                    </select>
                </div>
            </div>

            <button
                type="button"
                class="btn-primary full-width-btn"
                (click)="guardarDatosPerfil(perfilForm)"
                [disabled]="!perfilForm.valid || isSavingData"
            >
                {{ isSavingData ? 'Guardando...' : 'Guardar Cambios' }}
            </button>
        </form>
    </div>

    <!-- MODAL DEL CROPPER -->
    <div class="cropper-modal" *ngIf="mostrarCropper">
        <div class="cropper-content">

            <h2 class="cropper-title">Recortar Foto de Perfil</h2>

            <app-editar-foto
                (imagenFinal)="recibirImagenFinal($event)"
                (cancelar)="cerrarCropper()"
            ></app-editar-foto>

        </div>
    </div>

    <div class="status-area">
        <p class="status-message" *ngIf="mensajeExito">{{ mensajeExito }}</p>
        <p class="status-message error" *ngIf="mensajeError">{{ mensajeError }}</p>
    </div>
</div>

<style>
/* Estilos generales */
.profile-container {
    padding: 20px;
    background-color: #1a1a1a;
    color: #fff;
    min-height: 100vh;
}

.profile-card {
    max-width: 800px;
    margin: 0 auto;
    padding: 30px;
    background: #252525;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
}

h1 {
    font-size: 2.2em;
    border-bottom: 2px solid #c53030;
    padding-bottom: 10px;
    margin-bottom: 30px;
}

.section-heading {
    font-size: 1.5em;
    color: #c53030;
    margin-top: 30px;
    margin-bottom: 15px;
}

/* Sección de Foto */
.photo-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 40px;
}

.profile-image,
.default-profile-icon {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #c53030;
    margin-bottom: 15px;
}

.default-profile-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 4em;
    background-color: #333;
    color: #aaa;
}

.photo-upload-label {
    background-color: #c53030;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
}

.photo-upload-label:hover {
    background-color: #a32626;
}

/* Formulario */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-field {
    display: flex;
    flex-direction: column;
}

label {
    margin-bottom: 5px;
    font-weight: 500;
    color: #ccc;
}

input,
select {
    padding: 10px;
    border: 1px solid #444;
    border-radius: 6px;
    background-color: #333;
    color: white;
    font-size: 1em;
}

input:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

/* Botones */
.btn-primary {
    background-color: #c53030;
    color: white;
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s, opacity 0.3s;
}

.btn-primary:hover:not([disabled]) {
    background-color: #a32626;
}

.btn-primary[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
}

.full-width-btn {
    width: 100%;
    margin-top: 20px;
}

/* Área de mensajes */
.status-area {
    margin-top: 20px;
    text-align: center;
}

.status-message {
    padding: 10px;
    border-radius: 6px;
    font-weight: bold;
}

.status-message.error {
    background-color: #fce8e6;
    color: #c53030;
    border: 1px solid #c53030;
}

/* Modal del cropper */
.cropper-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.cropper-content {
    background: #252525;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.6);
    max-width: 90%;
    width: 650px;
    max-height: 90vh;
    overflow-y: auto;
}

.cropper-title {
    color: #c53030;
    text-align: center;
    margin-bottom: 20px;
}
</style>
